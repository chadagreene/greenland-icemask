

% Ice masks: 
fn = '/Users/cgreene/Documents/data/coastlines/greenland-coastlines-greene/greenland_monthly_ice_masks_2023-02-22.nc';
x = double(ncread(fn,'x'));
y = double(ncread(fn,'y'));
t = ncdateread(fn,'time');
t = datetime(1972,9,15):calmonths(1):datetime(2022,02,15);

tdn = datenum(t); 

D = load('terminus_data_densified_2023-01-09.mat');
color = parula(7); 

%%
kd = 258
   clear A
   close all
   
   S_tmp = m_shaperead(['/Users/cgreene/Documents/data/coastlines/AutoTerm/GID',num2str(kd),'.shp']);
   t_tmp = S_tmp.dbfdata(:,1);
   
   for sk = 1:length(t_tmp)
   
      [A(sk,1).X,A(sk,1).Y] = ll2psn(S_tmp.ncst{sk}(:,2),S_tmp.ncst{sk}(:,1)); 
   
   end
   
   for k=1:length(A) 
      A(k).X = A(k).X'; 
      A(k).Y = A(k).Y'; 
   end
   
   
   buf = 8e3; 
   xl = [min([A.X]) max([A.X])] + buf*[-1 1];
   yl = [min([A.Y]) max([A.Y])] + buf*[-1 1];
   
   %
   
   % Region of rows and columns of pixels to read: 
   ci=find((y>=yl(1))&(y<=yl(2)));
   ri=find((x>=xl(1))&(x<=xl(2)));
   
   x_tmp = x(ri); 
   y_tmp = y(ci); 
   
   ice = permute(logical(ncread(fn,'ice',[ri(1) ci(1) 1],[length(ri) length(ci) Inf])),[2 1 3]);
   rock = permute(logical(ncread(fn,'rock',[ri(1) ci(1)],[length(ri) length(ci)])),[2 1]);



sometimes_ice = any(ice,3) & ~all(ice,3); 
ice_sum = sum(ice(:,:,154:586),3); 
[X,Y] = meshgrid(x_tmp,y_tmp); 

flicker = sum(abs(double(ice(:,:,1:end-1))-double(ice(:,:,2:end))),3);

figure
%subsubplot(1,2,1) 
imagescn(x_tmp,y_tmp,ice_sum)
axis image 
hold on
ax = gca; 
axis off
set(gca,'pos',[0 0 1 1])
bedmachine('gl','color',rgb('gray'),'linewidth',.3,'greenland')

disableDefaultInteractivity(gca)

% subsubplot(1,2,2) 
% imagescn(x_tmp,y_tmp,flicker)
% axis image 
% ax(2)  = gca; 
% linkaxes(ax,'xy'); 
% axis off

%% 2 

trim = sometimes_ice & X>-263217 & X<-257850 & Y>-1984775 & Y<-1979589 & ice_sum<100; 

for k = 154:length(t)
    tmp = ice(:,:,k); 
    tmp(trim) = false; 
    ice(:,:,k) = tmp; 
end

%% 9

trim = sometimes_ice & X>-318146 & X<-314490 & Y>-1826849 & Y<-1823349 & ice_sum<86 ;
for k = 1:239
    tmp = ice(:,:,k); 
    tmp(trim) = false; 
    ice(:,:,k) = tmp; 
end

%% 10

trim = sometimes_ice & ice_sum<433 & inpolygon(X,Y,[-322183     -321592     -322678     -323954     -323935],[-1807295    -1805943    -1805638    -1805314    -1806762]); 

for k = 1:length(t)
    tmp = ice(:,:,k); 
    tmp(trim) = false; 
    ice(:,:,k) = tmp; 
end

%% 27 

trim = ~ice(:,:,248) & sometimes_ice & ice_sum<433 & inpolygon(X,Y,[-367902     -364253     -358703     -359615     -362884],[ -1578989    -1582790    -1581270    -1575796    -1575872]); 

for k = 248:length(t)
    tmp = ice(:,:,k); 
    tmp(trim) = false; 
    ice(:,:,k) = tmp; 
end

trim = ~ice(:,:,331) & ~ice(:,:,333) & sometimes_ice & ice_sum<433 & inpolygon(X,Y,[-367902     -364253     -358703     -359615     -362884],[ -1578989    -1582790    -1581270    -1575796    -1575872]); 

for k = 331:length(t)
    tmp = ice(:,:,k); 
    tmp(trim) = false; 
    ice(:,:,k) = tmp; 
end

%% 36

trim = sometimes_ice & ice_sum<300 & inpolygon(X,Y,[-378634     -373851     -373375     -374803     -377777],[-1496243    -1496410    -1494173    -1492745    -1492817]); 

for k = 1:length(t)
    tmp = ice(:,:,k); 
    tmp(trim) = false; 
    ice(:,:,k) = tmp; 
end

%% 37
trim = sometimes_ice & ice_sum<200 & inpolygon(X,Y,[-385219     -382166     -380802     -380750     -382803     -385271],[-1482959    -1482907    -1481335    -1479503    -1479218    -1479672]); 

for k = 1:384
    tmp = ice(:,:,k); 
    tmp(trim) = false; 
    ice(:,:,k) = tmp; 
end

trim = sometimes_ice & ice_sum<290 & ~ice(:,:,385) & inpolygon(X,Y,[-385219     -382166     -380802     -380750     -382803     -385271],[-1482959    -1482907    -1481335    -1479503    -1479218    -1479672]); 

for k = 385:length(t)
    tmp = ice(:,:,k); 
    tmp(trim) = false; 
    ice(:,:,k) = tmp; 
end

%% 39 tongue 

trim = sometimes_ice & ice_sum<100 & inpolygon(X,Y,[ -388348     -388950     -389837     -390361     -391191     -390224     -387745],[  -1476823    -1477028    -1477619    -1478233    -1479223    -1479928    -1476971]); 

for k = 1:length(t)
    tmp = ice(:,:,k); 
    tmp(trim) = false; 
    ice(:,:,k) = tmp; 
end

%% 40 

trim = sometimes_ice & ice_sum<230 & ~ice(:,:,122) & inpolygon(X,Y,[ -390876     -394700     -396164     -393480     -388273],[ -1462088    -1465206    -1466888    -1469301    -1468732]); 
trim = trim | (sometimes_ice & ice_sum<300& inpolygon(X,Y,[-395475     -395486     -394811     -394764],[ -1466838    -1467496    -1467543    -1466826 ])); 

for k = 122:length(t)
    tmp = ice(:,:,k); 
    tmp(trim) = false; 
    ice(:,:,k) = tmp; 
end

%% 48

trim = sometimes_ice & ice_sum<260 & ~ice(:,:,380) & inpolygon(X,Y,[-439894     -439527     -436162     -434052     -436162 ],[-1423335    -1432053    -1431471    -1426118    -1422448]); 

for k = 380:length(t)
    tmp = ice(:,:,k); 
    tmp(trim) = false; 
    ice(:,:,k) = tmp; 
end

%% 53 total failure 

disp 'need to address 53'

%% 60 

filler = sometimes_ice & inpolygon(X,Y,[ -524269     -524245     -522356     -521734     -520921     -523719],[-1403707    -1404544    -1408060    -1408395    -1408012    -1403803]); 

for k = 1:length(t)
    tmp = ice(:,:,k); 
    tmp(filler) = true; 
    ice(:,:,k) = tmp; 
end

%% 63

filler = sometimes_ice & inpolygon(X,Y,[-553586     -553608     -552135     -551920     -552957],[ -1383762    -1384026    -1384059    -1383629    -1383657]);

for k = 1:length(t)
    tmp = ice(:,:,k); 
    tmp(filler) = true; 
    ice(:,:,k) = tmp; 
end

%% 64

filler = sometimes_ice & inpolygon(X,Y,[-568553	-568115	-567360	-567754	-567841	-567885	-568039	-568280	-568838	-568849],[-1386506	-1386418	-1386298	-1385772	-1385640	-1385137	-1384874	-1384622	-1384709	-1385936]);

for k = 1:length(t)
    tmp = ice(:,:,k); 
    tmp(filler) = true; 
    ice(:,:,k) = tmp; 
end

%% 65
% some flicker remains in later years. 

trim = sometimes_ice & ice_sum<590 & inpolygon(X,Y,[ -570454     -571455     -571788     -570909     -566725     -568847     -569484     -569848],[-1391790    -1392882    -1394034    -1395004    -1390698    -1389364    -1390031    -1391365]);

for k = 1:length(t)
    tmp = ice(:,:,k); 
    tmp(trim) = false; 
    ice(:,:,k) = tmp; 
end

%% 68

trim = sometimes_ice & ice_sum<590 & inpolygon(X,Y,[-569886     -570042     -565293     -565395     -565476     -565788     -565881],[ -1331144    -1331579    -1332287    -1331434    -1331068    -1330565    -1329173]); 
for k = 1:length(t)
    tmp = ice(:,:,k); 
    tmp(trim) = false; 
    ice(:,:,k) = tmp; 
end

%% 70

trim = sometimes_ice & ice_sum<590 & inpolygon(X,Y,[-591095     -588758     -589531     -589550     -589801     -589743     -591153],[-1287004    -1287120    -1286522    -1285672    -1285150    -1284610    -1285092]); 
trim = trim | (ice_sum<10 & inpolygon(X,Y,[ -591230     -588527     -588082     -591481],[ -1287333    -1287275    -1283663    -1283683])); 

for k=1:length(t)
    tmp = ice(:,:,k); 
    tmp(trim) = false; 
    ice(:,:,k) = tmp; 
end

%% 84

trim = sometimes_ice & ~ice(:,:,71) & inpolygon(X,Y,[ -599056     -594851     -594956     -599612],[  -1139474    -1138570    -1136034    -1136763]); 

for k=1:70
    tmp = ice(:,:,k); 
    tmp(trim) = false; 
    ice(:,:,k) = tmp; 
end

%% 85 Humboldt 

trim = sometimes_ice & ice_sum<310 & inpolygon(X,Y,[ -398812     -398754     -411675     -411501     -408125],[-1086615    -1082424    -1087837    -1091970    -1096917]); 
trim =  trim | (sometimes_ice & ice_sum<400 & inpolygon(X,Y,[ -403992     -403294     -398870     -398870],[-1083646    -1089059    -1086964    -1082482]));

for k=1:length(t)
    tmp = ice(:,:,k); 
    tmp(trim) = false; 
    ice(:,:,k) = tmp; 
end

%% 97 

trim = sometimes_ice & ice_sum<260 & inpolygon(X,Y,[188301	188852	189402	189677	189585	189524	189096	188301	191756	193895	196402	196127	192520	190319],[-869117	-869759	-870768	-871655	-872480	-873152	-873703	-874406	-875445	-875903	-871960	-869056	-869331	-868475]); 

trim = trim | inpolygon(X,Y,[187829      189301      195055      195055      191523],[ -869089     -870079     -870882     -867697     -867322]); 

for k=1:length(t)
    tmp = ice(:,:,k); 
    tmp(trim) = false; 
    ice(:,:,k) = tmp; 
end

%% 108 

%trim = sometimes_ice &  inpolygon(X,Y,[],[]); 
trim = sometimes_ice &  inpolygon(X,Y,[  604352      604527      605295      605723      605681],[-1437733    -1438629    -1438649    -1437984    -1437616]); 

for k=1:length(t)
    tmp = ice(:,:,k); 
    tmp(trim) = false; 
    ice(:,:,k) = tmp; 
end

%% 121 

trim = sometimes_ice &  inpolygon(X,Y,[586407      586035      585553      585954      587119      586718],[  -2056048    -2056572    -2057342    -2057738    -2056166    -2055898]); 
for k=1:157
    tmp = ice(:,:,k); 
    tmp(trim) = false; 
    ice(:,:,k) = tmp; 
end

trim = ice_sum>0 &  inpolygon(X,Y,[588946      588642      588981      589527      589335],[-2060549    -2061322    -2061691    -2060683    -2060541]); 

for k=1:length(t)
    tmp = ice(:,:,k); 
    tmp(trim) = false; 
    ice(:,:,k) = tmp; 
end

%% 123 

trim = ice_sum>0 &  inpolygon(X,Y,[605339	605363	606319	606845	608160	611315	614853	610551	608949	608566	608423	608088	607562	606702	606224],[-1971757	-1972498	-1974124	-1975128	-1976323	-1979264	-1974267	-1969463	-1970036	-1970299	-1970801	-1971255	-1971662	-1972020	-1971829]); 

for k=1:length(t)
    tmp = ice(:,:,k); 
    tmp(trim) = false; 
    ice(:,:,k) = tmp; 
end

%% 127 

trim = ice_sum>0 &  inpolygon(X,Y,[729451	729458	729780	730460	731118	731170	730729	729825],[-2026156	-2027397	-2028331	-2028787	-2028697	-2028271	-2026567	-2026111]); 

for k=1:length(t)
    tmp = ice(:,:,k); 
    tmp(trim) = false; 
    ice(:,:,k) = tmp; 
end
%% 128 

trim = ice_sum>0 &  inpolygon(X,Y,[781668	781968	782340	782640	782981	783291	783581	784005	784118	784222	784263	784294	784511	784449	783084],[-2025499	-2026398	-2026305	-2026419	-2026688	-2026915	-2026967	-2026626	-2026347	-2026078	-2025757	-2025592	-2025396	-2024320	-2024351]); 

for k=1:length(t)
    tmp = ice(:,:,k); 
    tmp(trim) = false; 
    ice(:,:,k) = tmp; 
end

%% 138
trim = ice_sum>0 &  inpolygon(X,Y,[708446	708391	710397	710807	710160	709732	709604	709713	709558	709294	709157	709057	708875	708711	708610],[-2231889	-2232071	-2233530	-2232992	-2230613	-2230485	-2230604	-2230786	-2231014	-2231142	-2231342	-2231388	-2231670	-2231716	-2231853]); 

for k=1:length(t)
    tmp = ice(:,:,k); 
    tmp(trim) = false; 
    ice(:,:,k) = tmp; 
end

%% 139
trim = ice_sum>0 &  inpolygon(X,Y,[704979      704491      704159      703758      703496      703741      705136      705363],[  -2233012    -2233099    -2233134    -2233309    -2233518    -2234216    -2233727    -2233221]); 

for k=188:length(t)
    tmp = ice(:,:,k); 
    tmp(trim) = false; 
    ice(:,:,k) = tmp; 
end

trim = ice_sum>0 &  inpolygon(X,Y,[704811	704690	704359	704004	703665	703584	703382	703213	703067	703415	703826	705110	705029],[-2232576	-2232665	-2232714	-2232819	-2232875	-2233053	-2233247	-2233327	-2233465	-2234232	-2234167	-2233255	-2232722]); 

for k=298:length(t)
    tmp = ice(:,:,k); 
    tmp(trim) = false; 
    ice(:,:,k) = tmp; 
end

%% 141
trim = ice_sum>0& sometimes_ice &  inpolygon(X,Y,[ 668695      668729      669911      669658      670633      670094      669670      669498      669372],[-2261073    -2263665    -2263722    -2262243    -2261578    -2261268    -2261142    -2261027    -2260844]); 

for k=1:length(t)
    tmp = ice(:,:,k); 
    tmp(trim) = false; 
    ice(:,:,k) = tmp; 
end

%% 150
trim = ice_sum>0&  inpolygon(X,Y,[504721	504477	504404	504319	504197	504209	504099	503965	504258	505662	508054	507896	507896	507847	507725	507542	507359	507139	507053	507224	507383	507554	507627	507700	507591	507444	507273	507066	506907	504892],[-2285430	-2285504	-2285662	-2285833	-2285992	-2286285	-2286456	-2286578	-2287091	-2287750	-2287933	-2287726	-2287579	-2287481	-2287323	-2287262	-2287176	-2287079	-2286822	-2286651	-2286358	-2286126	-2285968	-2285797	-2285650	-2285577	-2285565	-2285382	-2285125	-2285235]); 

for k=1:length(t)
    tmp = ice(:,:,k); 
    tmp(trim) = false; 
    ice(:,:,k) = tmp; 
end

%% 155 weird big area 

trim = ice_sum>0 & ice_sum<300 &  inpolygon(X,Y,[  516062      516869      533800      532662      526822],[  -2327945    -2334446    -2336319    -2326623    -2324640]); 

trim = trim |(ice_sum>0 & inpolygon(X,Y,[528891	529039	529280	529658	529958	530318	530801	531143	531509	531656	529227	528767],[-2334512	-2334654	-2334895	-2334978	-2335013	-2335049	-2334960	-2334889	-2334648	-2334394	-2332838	-2333592]));
trim = trim |(ice_sum>0 & inpolygon(X,Y,[517878	517984	518014	518014	518279	518621	518827	519146	519275	519423	519741	519299],[-2332561	-2332885	-2332926	-2332991	-2333121	-2333215	-2333221	-2333162	-2333056	-2333009	-2332649	-2331765]));

for k=1:length(t)
    tmp = ice(:,:,k); 
    tmp(trim) = false; 
    ice(:,:,k) = tmp; 
end

%% 164 island after Aug 1999 

trim = sometimes_ice & ice_sum>260 & inpolygon(X,Y,[489486      490164      490172      489453],[ -2450823    -2450864    -2450259    -2450276]); 

for k=324:length(t)
    tmp = ice(:,:,k); 
    tmp(trim) = false; 
    ice(:,:,k) = tmp; 
end

%% 165 a couple of bad picks, apparently 

trim = sometimes_ice & ice_sum<120 & inpolygon(X,Y,[478352	478260	478220	477954	477934	477995	478015	478873	479914	478546],[-2476986	-2477098	-2477374	-2477466	-2477670	-2478007	-2478180	-2478231	-2476802	-2476864]); 

for k=1:length(t)
    tmp = ice(:,:,k); 
    tmp(trim) = false; 
    ice(:,:,k) = tmp; 
end

%% 178 crazy long-fjord failure

trim = sometimes_ice & inpolygon(X,Y,[362518	361632	356388	361606	361657	362189	362214	362442	362772	363228	363937	365508	365989	365888	365508	365356	365356	364672	363810	363050],[-2569641	-2569311	-2574555	-2576405	-2575721	-2575037	-2574707	-2574403	-2574302	-2574175	-2574378	-2573061	-2571034	-2570705	-2570299	-2569995	-2569615	-2569362	-2569387	-2569539]); 
for k=1:length(t)
    tmp = ice(:,:,k); 
    tmp(trim) = false; 
    ice(:,:,k) = tmp; 
end

trim = sometimes_ice & inpolygon(X,Y,[361954	366126	368258	367992	367472	366859	366286	365633	365233],[-2569495	-2571281	-2567736	-2567469	-2566936	-2566470	-2566310	-2565763	-2565657]); 

for k=257:length(t)
    tmp = ice(:,:,k); 
    tmp(trim) = false; 
    ice(:,:,k) = tmp; 
end

trim = sometimes_ice & inpolygon(X,Y,[365140	368232	369311	368952	368698	368392	367979	367205	366699	366179],[-2565883	-2568043	-2566083	-2565857	-2565497	-2565164	-2564950	-2564710	-2564524	-2564537]); 

for k=336:length(t)
    tmp = ice(:,:,k); 
    tmp(trim) = false; 
    ice(:,:,k) = tmp; 
end

trim = sometimes_ice & inpolygon(X,Y,[365714	369191	370936	370740	370490	369887	369427	369086	368469	367839],[-2564508	-2566463	-2563786	-2563130	-2562750	-2562317	-2562212	-2561949	-2561739	-2561779]); 

for k=437:length(t)
    tmp = ice(:,:,k); 
    tmp(trim) = false; 
    ice(:,:,k) = tmp; 
end

trim = sometimes_ice & inpolygon(X,Y,[367399	370825	370996	370953	371167	371456	372773	373812	373319	373169	372688	372120	372045	371638	371017	370589],[-2561733	-2563928	-2563424	-2562996	-2562846	-2562739	-2562793	-2561048	-2560523	-2560213	-2559763	-2559345	-2559099	-2558617	-2558510	-2558510]); 

for k=452:length(t)
    tmp = ice(:,:,k); 
    tmp(trim) = false; 
    ice(:,:,k) = tmp; 
end

trim = sometimes_ice & inpolygon(X,Y,[370632	373405	374272	374069	374122	374144	374176	374369	374529	374529	374112	373823	373630	373566	373330	372902	372538	372227	371853	371746	371339],[-2558553	-2561347	-2560320	-2559881	-2559174	-2558649	-2558467	-2558317	-2558082	-2557632	-2557236	-2557193	-2557375	-2557547	-2557611	-2557707	-2557846	-2557900	-2558093	-2558425	-2558510]);

for k=530:length(t)
    tmp = ice(:,:,k); 
    tmp(trim) = false; 
    ice(:,:,k) = tmp; 
end

%% 180 

trim = sometimes_ice & inpolygon(X,Y,[ 337703      337753      338498      339209      339192      338261      337601],[ -2576801    -2577038    -2577411    -2577428    -2576784    -2575718    -2576243]);

for k=360:length(t)
    tmp = ice(:,:,k); 
    tmp(trim) = false; 
    ice(:,:,k) = tmp; 
end

%% 187

trim = sometimes_ice & inpolygon(X,Y,[236432	236774	238944	239508	239434	239063	238691	238186	237621	237339	236878],[-2674990	-2675540	-2676610	-2676610	-2675971	-2675718	-2675020	-2674009	-2673979	-2674172	-2674470]); 

for k=418:length(t)
    tmp = ice(:,:,k); 
    tmp(trim) = false; 
    ice(:,:,k) = tmp; 
end

trim = sometimes_ice & inpolygon(X,Y,[236521	239508	239464	239033	238795	238513	238260	238201	237918	237636	237264	236952	236789	236863	236848	236744	236610],[-2674945	-2676149	-2675183	-2674678	-2674618	-2674633	-2673875	-2673637	-2673296	-2673162	-2673266	-2673429	-2673593	-2673831	-2673979	-2674187	-2674277]);

for k=526:length(t)
    tmp = ice(:,:,k); 
    tmp(trim) = false; 
    ice(:,:,k) = tmp; 
end

trim = sometimes_ice & inpolygon(X,Y,[236774      238260      238097      237353      237056      236729      236640      236774],[ -2674217    -2673771    -2673370    -2672984    -2672984    -2673147    -2673355    -2673860]);
for k=550:length(t)
    tmp = ice(:,:,k); 
    tmp(trim) = false; 
    ice(:,:,k) = tmp; 
end

%% 194 

trim = sometimes_ice & ice_sum<200 & inpolygon(X,Y,[211052      212433      212274      211876      211807      211628      211151],[ -2725651    -2725661    -2725134    -2725085    -2724618    -2724429    -2724429]);

for k=1:length(t)
    tmp = ice(:,:,k); 
    tmp(trim) = false; 
    ice(:,:,k) = tmp; 
end

%% 195 ack discovered rock error! 

rock(inpolygon(X,Y,[205823      204685      204667      205236      207662      207251      207102      206051],[ -2720297    -2721847    -2722434    -2722802    -2721120    -2720148    -2719903    -2719903]))=false; 

trim = inpolygon(X,Y,[204965	205175	207697	207286	207181	206962	206725	206550	206349	206130	205998	205928	205920	205753	205736	205718	205701	205622	205508	205280	205096	205000],[-2722627	-2722767	-2721243	-2720577	-2720262	-2720140	-2720087	-2720096	-2720069	-2720078	-2720236	-2720437	-2720560	-2720770	-2720989	-2721182	-2721374	-2721506	-2721690	-2721882	-2722163	-2722504]); 

for k=432:length(t)
    tmp = ice(:,:,k); 
    tmp(trim) = false; 
    ice(:,:,k) = tmp; 
end

%% 196 i think

trim = sometimes_ice & ice_sum<400 & inpolygon(X,Y,[  184328      186978      187550      187505      187038      186481      186165      185728      184795],[ -2727870    -2729045    -2729060    -2727855    -2727359    -2726877    -2726832    -2726892    -2727283]);

for k=274:length(t)
    tmp = ice(:,:,k); 
    tmp(trim) = false; 
    ice(:,:,k) = tmp; 
end

trim = sometimes_ice & ice_sum<400 & inpolygon(X,Y,[ 184599      184073      184584      186782      186300      185789      185141],[-2727494    -2728172    -2728533    -2727193    -2726621    -2726651    -2726967]); 

for k=322:length(t)
    tmp = ice(:,:,k); 
    tmp(trim) = false; 
    ice(:,:,k) = tmp; 
end

trim = sometimes_ice & ice_sum<400 & inpolygon(X,Y,[183786	184253	186722	186316	186105	185759	185322	184825	184524	184193],[-2727615	-2728126	-2727027	-2726395	-2726260	-2726245	-2726335	-2726471	-2726621	-2726982]); 

for k=550:length(t)
    tmp = ice(:,:,k); 
    tmp(trim) = false; 
    ice(:,:,k) = tmp; 
end

trim = sometimes_ice & ice_sum<400 & inpolygon(X,Y,[183531	183937	186361	186045	185427	185141	184946	184359	184073	183802],[-2727268	-2727630	-2726335	-2725929	-2725778	-2725959	-2726124	-2726305	-2726501	-2726892]); 

for k=574:length(t)
    tmp = ice(:,:,k); 
    tmp(trim) = false; 
    ice(:,:,k) = tmp; 
end

%% 198 another rock mask problem! 

rock(inpolygon(X,Y,[189047	188947	188804	188826	188847	188755	189474	189923	190614	190977	191334	191612	191661	191013	189645],[-2755897	-2756367	-2756581	-2756837	-2757158	-2757500	-2757977	-2758162	-2758469	-2758176	-2757913	-2757599	-2757115	-2756281	-2755889])) = false; 

trim = inpolygon(X,Y,[189018	188990	189232	189538	189723	190115	190365	190707	190928	191120	191270	191483	191170	189510	189189],[-2756816	-2757222	-2757350	-2757535	-2757699	-2757763	-2757842	-2757849	-2757777	-2757607	-2757300	-2757008	-2756224	-2755768	-2755804]); 

for k=382:length(t)
    tmp = ice(:,:,k); 
    tmp(trim) = false; 
    ice(:,:,k) = tmp; 
end
%% 209 

trim = sometimes_ice & ice_sum<209 & inpolygon(X,Y,[177616	177718	180668	181217	180985	180761	180575	180361	180138	179896	179598],[-2819304	-2820682	-2820896	-2820114	-2819798	-2819602	-2819537	-2819519	-2819221	-2819025	-2819007]); 

for k=1:length(t)
    tmp = ice(:,:,k); 
    tmp(trim) = false; 
    ice(:,:,k) = tmp; 
end

trim = sometimes_ice & ice_sum<300 & inpolygon(X,Y,[179598      181171      181590      181431      181115      180799      180501      180389      179812],[ -2818988    -2820263    -2819584    -2819416    -2819044    -2819053    -2818774    -2818523    -2818355]); 

for k=334:length(t)
    tmp = ice(:,:,k); 
    tmp(trim) = false; 
    ice(:,:,k) = tmp; 
end

%% 214 

trim = inpolygon(X,Y,[198141	198323	198528	198733	199007	199178	199543	199896	200261	200603	200591	200227	199862],[-2847703	-2847862	-2847919	-2848113	-2848239	-2848250	-2848079	-2848068	-2848227	-2848284	-2847634	-2847327	-2847258]); 

for k=1:length(t)
    tmp = ice(:,:,k); 
    tmp(trim) = false; 
    ice(:,:,k) = tmp; 
end

trim = inpolygon(X,Y,[198403	198745	198916	199166	199280	200044	200420	200705	200762	200660	199816],[-2847646	-2848136	-2848410	-2848706	-2848729	-2848592	-2848512	-2848489	-2848011	-2847634	-2847247]); 

for k=445:length(t)
    tmp = ice(:,:,k); 
    tmp(trim) = false; 
    ice(:,:,k) = tmp; 
end

trim = inpolygon(X,Y,[197935	197867	198163	198357	198722	198995	199212	199269	200135	200284	200363	200648	200774],[-2847270	-2847669	-2847988	-2848033	-2848318	-2848683	-2849299	-2849686	-2849504	-2849299	-2848922	-2848717	-2847828]); 

for k=455:length(t)
    tmp = ice(:,:,k); 
    tmp(trim) = false; 
    ice(:,:,k) = tmp; 
end

%% 219

trim = sometimes_ice & inpolygon(X,Y,[217304	217104	216871	216971	218291	219678	219900	219667	219501	219223	218857	218547	218214	217781	217681	217470],[-2889254	-2889565	-2889909	-2890108	-2890175	-2889587	-2889187	-2888877	-2888832	-2888688	-2888710	-2888810	-2889121	-2889165	-2889309	-2889199]); 

for k=442:length(t)
    tmp = ice(:,:,k); 
    tmp(trim) = false; 
    ice(:,:,k) = tmp; 
end

%% 226 

rock(inpolygon(X,Y,[163116	163780	164014	164802	164374	164774	165576	165576	164885	164429	163862],[-2907470	-2907788	-2908078	-2910137	-2910634	-2911339	-2910496	-2909777	-2908520	-2907843	-2907249])) = false; 

filler = inpolygon(X,Y,[163566	163939	164357	164633	164999	165288	165545	165494	165610	165622	165128	164903	164749	164627	164479	164337	164042	163714],[-2907508	-2910271	-2910657	-2911338	-2911183	-2910849	-2910535	-2910284	-2910021	-2909841	-2908986	-2908459	-2908440	-2908177	-2907913	-2907759	-2907489	-2907444]);

for k = 1:333
    tmp = ice(:,:,k); 
    tmp(filler) = true; 
    ice(:,:,k) = tmp; 
end

filler = inpolygon(X,Y,[163560	163573	164003	164370	164485	164659	164903	165057	165327	165333	165256	165192	165340	165218	165076	164813	164723	164562	164498	164331	164190	163920],[-2907502	-2907785	-2910483	-2910650	-2910926	-2910830	-2910817	-2910811	-2910374	-2910233	-2910046	-2909731	-2909455	-2909314	-2908826	-2908485	-2908382	-2908177	-2907952	-2907727	-2907605	-2907476]);

for k = 334:453
    tmp = ice(:,:,k); 
    tmp(filler) = true; 
    ice(:,:,k) = tmp; 
end

%% 231 


trim = sometimes_ice & inpolygon(X,Y,[97411       97741      100024       98810       98375       97966       97649       97438],[-3006240    -3006398    -3005369    -3004049    -3004458    -3004775    -3005197    -3005725]); 
for k=1:153
    tmp = ice(:,:,k); 
    tmp(trim) = false; 
    ice(:,:,k) = tmp; 
end


trim = sometimes_ice & inpolygon(X,Y,[98507	98335	97926	97675	97411	97319	97279	97860	99813	100077	99140],[-3003851	-3004102	-3004300	-3004577	-3004907	-3005263	-3005857	-3006398	-3005976	-3005065	-3003970]); 

for k=154:length(t)
    tmp = ice(:,:,k); 
    tmp(trim) = false; 
    ice(:,:,k) = tmp; 
end

%%

trim = sometimes_ice & inpolygon(X,Y,[104326	104187	104169	104242	104362	104680	105089	105252	106430	106550	105492	105119	104843	104584],[-3031336	-3031571	-3031962	-3032226	-3032425	-3032833	-3032966	-3032906	-3032208	-3031403	-3030753	-3030705	-3030819	-3031060]); 

for k=341:length(t)
    tmp = ice(:,:,k); 
    tmp(trim) = false; 
    ice(:,:,k) = tmp; 
end

trim = sometimes_ice & inpolygon(X,Y,[101956	104404	106000	103958	103484	103078	102645	102348	102213	102158],[-3030752	-3032713	-3030765	-3029264	-3029331	-3029413	-3029616	-3029764	-3030211	-3030617]); 

for k=430:length(t)
    tmp = ice(:,:,k); 
    tmp(trim) = false; 
    ice(:,:,k) = tmp; 
end

%% 237 

trim = ~rock & inpolygon(X,Y,[126270	126082	126172	126441	126629	126889	127068	127301	127696	127929	128090	128216	128288	129014	129274	129435	129695	129938	130296	130556	130771	130996	131121	131130	128835	127032],[-3052448	-3052681	-3053470	-3053551	-3053479	-3053542	-3053542	-3053470	-3053551	-3053488	-3053407	-3052986	-3052887	-3052941	-3052986	-3053156	-3053407	-3053353	-3053237	-3053048	-3052735	-3052421	-3052331	-3051999	-3051829	-3052089]); 

for k=1:length(t)
    tmp = ice(:,:,k); 
    tmp(trim) = false; 
    ice(:,:,k) = tmp; 
end

trim = ~rock & inpolygon(X,Y,[129651      129973      130413      130780      131256      131273      131058],[-3053335    -3053577    -3053461    -3053416    -3052896    -3052618    -3052170]); 

for k=346:length(t)
    tmp = ice(:,:,k); 
    tmp(trim) = false; 
    ice(:,:,k) = tmp; 
end

trim = ~rock & inpolygon(X,Y,[129435	129417	129713	129982	130332	130619	130924	131139	131309	131533	131587	131695	131785	130951	129812],[-3052788	-3053102	-3053515	-3053793	-3053775	-3053649	-3053577	-3053542	-3053443	-3053138	-3053084	-3052914	-3052600	-3052412	-3052484]); 

for k=454:length(t)
    tmp = ice(:,:,k); 
    tmp(trim) = false; 
    ice(:,:,k) = tmp; 
end

%% 243 

trim = sometimes_ice & inpolygon(X,Y,[120507	120475	120810	121717	122278	122207	122052	121846	121672	121383	121228	121170	121029	120823	120694	120687],[-3112256	-3112610	-3113486	-3113524	-3112719	-3112327	-3112307	-3112159	-3112275	-3112262	-3112249	-3112076	-3111966	-3111940	-3111985	-3112146]); 

for k=1:length(t) 
    tmp = ice(:,:,k); 
    tmp(trim) = false; 
    ice(:,:,k) = tmp; 
end


trim = sometimes_ice & inpolygon(X,Y,[120533	120462	120958	122065	122342	122213	122052	121936	121634	121132	120810],[-3111689	-3112649	-3113679	-3113679	-3112372	-3111792	-3111760	-3111612	-3111625	-3111670	-3111593]); 

for k=366:length(t) 
    tmp = ice(:,:,k); 
    tmp(trim) = false; 
    ice(:,:,k) = tmp; 
end

trim = sometimes_ice & inpolygon(X,Y,[120455	120485	122356	122188	122067	121876	121702	121565	121223	121177	120789	120622],[-3111386	-3112808	-3112831	-3111523	-3111470	-3111371	-3111310	-3111196	-3111143	-3111013	-3111150	-3111264]); 

for k=416:length(t)
    tmp = ice(:,:,k); 
    tmp(trim) = false; 
    ice(:,:,k) = tmp; 
end

%% 244 

trim =  inpolygon(X,Y,[  116436      116887      117718      117652      117223      117154      116977      116445],[-3116925    -3116928    -3115562    -3115093    -3115141    -3115444    -3115874    -3116633]); 

for k=1:length(t)
    tmp = ice(:,:,k); 
    tmp(trim) = false; 
    ice(:,:,k) = tmp; 
end

%% 247

trim =  inpolygon(X,Y,[105908	107755	108344	109108	107603	107356	106975	106767	106615	106458	106295	106183	106054],[-3139475	-3140300	-3139475	-3137847	-3137297	-3137499	-3137431	-3137532	-3137549	-3137886	-3138240	-3138588	-3139042]); 

for k=  354:length(t)
    tmp = ice(:,:,k); 
    tmp(trim) = false; 
    ice(:,:,k) = tmp; 
end

%% 248

trim =  inpolygon(X,Y,[112602	112566	112623	112687	112948	113090	113203	113387	113507	113592	113655	113938	114249	114277	113719	113040],[-3145569	-3145859	-3146170	-3146396	-3146658	-3146764	-3146771	-3146615	-3146580	-3146424	-3146255	-3145965	-3145689	-3145307	-3144954	-3145046]); 

for k=  1:length(t)
    tmp = ice(:,:,k); 
    tmp(trim) = false; 
    ice(:,:,k) = tmp; 
end

trim =  inpolygon(X,Y,[111972	112057	112142	112291	112390	112609	113033	113478	113790	114044	113507	112573],[-3145654	-3146290	-3146743	-3147096	-3147216	-3147188	-3146948	-3146594	-3146368	-3146085	-3145640	-3145576]); 

for k=  378:length(t)
    tmp = ice(:,:,k); 
    tmp(trim) = false; 
    ice(:,:,k) = tmp; 
end

%% 253 

trim =  inpolygon(X,Y,[68198	68280	73985	75270	73657	72397	68820	68673	68346	68067	68157	68198	68018],[-3194635	-3194847	-3194913	-3192286	-3191680	-3192433	-3193300	-3193521	-3193620	-3193792	-3193931	-3194127	-3194332]); 

for k=  380:length(t)
    tmp = ice(:,:,k); 
    tmp(trim) = false; 
    ice(:,:,k) = tmp; 
end

trim =  inpolygon(X,Y,[67617	67752	68315	68301	67928	67646	67097	67071	67210	67241	67253],[-3194693	-3194829	-3194809	-3193712	-3193668	-3193599	-3193683	-3194029	-3194295	-3194474	-3194624]); 

for k=  569:length(t)
    tmp = ice(:,:,k); 
    tmp(trim) = false; 
    ice(:,:,k) = tmp; 
end

%% 258 

trim =  ice_sum>0 & inpolygon(X,Y,[66380	66331	66371	66595	66889	67055	67270	67368	67593	69783	69920	66772],[-3239044	-3239249	-3239474	-3239699	-3239738	-3239728	-3239718	-3239757	-3239748	-3239337	-3238555	-3238731]); 

for k=  578:length(t)
    tmp = ice(:,:,k); 
    tmp(trim) = false; 
    ice(:,:,k) = tmp; 
end

%% 259 


trim =  ice_sum>0 & inpolygon(X,Y,[],[]); 

for k=  :length(t)
    tmp = ice(:,:,k); 
    tmp(trim) = false; 
    ice(:,:,k) = tmp; 
end